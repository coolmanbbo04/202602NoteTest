# Notepad Web App（便签）— PRD（反向补齐 v1）

## 1. 背景与目标
本项目是一个轻量便签应用，用于快速记录与检索信息，支持分享链接与语音输入。目标是达到“日用平均水平”，并形成可复用的一键生成/发布流程模板。

### 核心目标（Must）
- 创建、查看、编辑、自动保存便签
- 列表搜索/过滤（标题+内容）
- 排序（最近更新/最近创建/标题 A-Z）
- 置顶 Pin（本机生效）
- 分享链接（只读访问）
- 编辑页快捷键（Ctrl/Cmd+S 保存、Esc 返回、/ 聚焦搜索）
- 语音输入（新建后直接说，识别内容追加到正文）
- 可靠性：离线草稿保护、断网不丢、恢复后自动尝试同步
- 冲突处理：同一便签多窗口编辑检测 updated_at 变化，提示覆盖/复制/取消

### 非目标（Not now）
- 账户体系/多用户协作
- 标签/文件夹/回收站（需要额外数据模型）
- Markdown 渲染与富文本编辑器
- 云端 Pin 同步、跨设备离线同步

## 2. 用户画像与使用场景
- 个人用户：灵感/待办/临时记录
- 场景：桌面浏览器快速记；手机浏览器临时记；分享给别人只读查看

## 3. 主要页面与流程
### 3.1 便签列表页（/）
- 顶部操作：新建、刷新、搜索框、排序下拉、结果计数
- 列表项：标题（若为空用正文第一行推断）、摘要、更新时间、置顶按钮、分享状态提示
- 快捷键：按 / 聚焦搜索框
- Pin：点击置顶/取消置顶（仅本机 localStorage）

### 3.2 编辑页（/notes/:id）
- 字段：标题（可选）、正文
- 自动保存：停止输入约 600ms 自动保存；也可 Ctrl/Cmd+S 立即保存
- Esc：返回列表（若语音监听中，优先停止监听）
- Tab：正文插入缩进（两个空格）
- 标题回车：跳到正文
- 语音输入：按钮开始/停止；识别文本追加到正文；显示 interim；错误提示
- 分享：生成分享链接并复制；展示分享 URL；支持复制
- 删除：确认后删除并返回列表
- 离线草稿：本地持续保存；加载时检测草稿并提示恢复/丢弃；恢复网络时自动尝试同步
- 冲突：保存前检测服务器 updated_at 是否变化；提示覆盖/复制为新便签/取消

### 3.3 分享页（/share/:shareId）
- 只读展示便签内容（标题/正文）
- 不要求登录

## 4. 数据与规则
- title 可为空；为空时 UI 展示为正文第一行（截断）
- content 允许为空（展示为空态）
- updated_at 由后端更新；用于排序与冲突检测
- share_id 由后端生成；分享链接为 /share/{share_id}

## 5. 可靠性与错误处理
- 保存失败：提示“保存失败（草稿已保存）”，不丢数据
- 离线：显示离线状态，继续编辑写入 localStorage
- 网络恢复：若 dirty 自动尝试保存
- 冲突：给用户选择（覆盖/复制/取消）

## 6. 验收标准（摘要）
详见 spec/acceptance_tests.md。
